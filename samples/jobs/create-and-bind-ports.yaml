---
  version: 2
  title: Create and bind ports using Rally runner for repeats
  # XXX: We're still using tasks for creating/deleting sandboxes
  subtasks:
    -
      title: Delete sandboxes
      workloads:
        -
          name: OvnSandbox.delete_sandbox
          args:
            sandbox_delete_args:
              farm: "ovn-farm-node-0"
              graceful: True
          runner:
            type: "serial"
            times: 1
          context:
            ovn_multihost:
              controller: "ovn-controller-node"
    -
      title: (Re)create controller sandbox
      workloads:
        -
          name: OvnSandbox.create_controller
          args:
            controller_create_args:
              controller_cidr: "192.168.33.2/24"
              net_dev: "eth1"
          runner:
            type: "serial"
            times: 1
          context:
            ovn_multihost:
              controller: "ovn-controller-node"
    -
      title: Create sandboxes
      workloads:
        -
          name: OvnSandbox.create_sandbox
          args:
            sandbox_create_args:
              farm: "ovn-farm-node-0"
              amount: 10
              batch: 10
              start_cidr: "192.168.33.10/24"
              net_dev: "eth1"
          runner:
            type: "serial"
            times: 1
          context:
            ovn_multihost:
              controller: "ovn-controller-node"

    -
      title: Create and bind ports
      workloads:
        -
          name: OvnNetwork.create_and_bind_ports
          args:
            network_create_args: {}
            port_create_args:
              batch: 2
            ports_per_network: 2
            port_bind_args:
              wait_up: True
          runner:
            type: "constant"
            times: 100
            concurrency: 2
          context:
            ovn_multihost:
              controller: "ovn-controller-node"
            sandbox:
              tag: "all"
